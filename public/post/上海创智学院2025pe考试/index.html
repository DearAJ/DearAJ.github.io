<!DOCTYPE html>
<html lang="en-US">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>上海创智学院2025PE考试 | HomePage</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="
注意：提示词都是用中文编写，若将中文直接翻译成英文，效果可能下降。

任务理解

给定数据结构如下所示的数据：
val.jsonl中，每⼀条数据的字段说明：
{
    &#34;user_id&#34;: 5737, // ⽤⼾编号
    &#34;item_list&#34;: [ // ⽤⼾历史观看电影列表，按时间顺序排列，越靠后表⽰越近期观看
    [1836, &#34;Last Days of Disco, The&#34;], // [电影ID, 电影名称]
    [3565, &#34;Where the Heart Is&#34;],
    // ... 更多历史观看记录，⻓度不定
    ],
    &#34;target_item&#34;: [1893, &#34;Beyond Silence&#34;], // ⽤⼾实际观看的下⼀部电影 [电影ID, 电影名称]
    &#34;candidates&#34;: [ // 推荐系统召回阶段得到的候选电影列表
    [2492, &#34;20 Dates&#34;],
    [684, &#34;Windows&#34;],
    [1893, &#34;Beyond Silence&#34;], // 包含⽤⼾实际观看的下⼀部电影
    // ... 更多候选电影，⻓度不定，⼀般为20个左右
    ]
}
我们需要将candidates列表按照匹配度进行重排序，列表第一个元素是最有可能（最喜欢）观看的电影，列表最后一个是最不可能（最不喜欢）的电影。">
    <meta name="generator" content="Hugo 0.140.2">
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/post/%E4%B8%8A%E6%B5%B7%E5%88%9B%E6%99%BA%E5%AD%A6%E9%99%A22025pe%E8%80%83%E8%AF%95/">
    

    <meta property="og:url" content="http://localhost:1313/post/%E4%B8%8A%E6%B5%B7%E5%88%9B%E6%99%BA%E5%AD%A6%E9%99%A22025pe%E8%80%83%E8%AF%95/">
  <meta property="og:site_name" content="HomePage">
  <meta property="og:title" content="上海创智学院2025PE考试">
  <meta property="og:description" content="注意：提示词都是用中文编写，若将中文直接翻译成英文，效果可能下降。
任务理解 给定数据结构如下所示的数据：
val.jsonl中，每⼀条数据的字段说明： { &#34;user_id&#34;: 5737, // ⽤⼾编号 &#34;item_list&#34;: [ // ⽤⼾历史观看电影列表，按时间顺序排列，越靠后表⽰越近期观看 [1836, &#34;Last Days of Disco, The&#34;], // [电影ID, 电影名称] [3565, &#34;Where the Heart Is&#34;], // ... 更多历史观看记录，⻓度不定 ], &#34;target_item&#34;: [1893, &#34;Beyond Silence&#34;], // ⽤⼾实际观看的下⼀部电影 [电影ID, 电影名称] &#34;candidates&#34;: [ // 推荐系统召回阶段得到的候选电影列表 [2492, &#34;20 Dates&#34;], [684, &#34;Windows&#34;], [1893, &#34;Beyond Silence&#34;], // 包含⽤⼾实际观看的下⼀部电影 // ... 更多候选电影，⻓度不定，⼀般为20个左右 ] } 我们需要将candidates列表按照匹配度进行重排序，列表第一个元素是最有可能（最喜欢）观看的电影，列表最后一个是最不可能（最不喜欢）的电影。">
  <meta property="og:locale" content="en_US">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2025-05-12T11:00:59-04:00">
    <meta property="article:modified_time" content="2025-05-12T11:00:59-04:00">
    <meta property="article:tag" content="考试">

  <meta itemprop="name" content="上海创智学院2025PE考试">
  <meta itemprop="description" content="注意：提示词都是用中文编写，若将中文直接翻译成英文，效果可能下降。
任务理解 给定数据结构如下所示的数据：
val.jsonl中，每⼀条数据的字段说明： { &#34;user_id&#34;: 5737, // ⽤⼾编号 &#34;item_list&#34;: [ // ⽤⼾历史观看电影列表，按时间顺序排列，越靠后表⽰越近期观看 [1836, &#34;Last Days of Disco, The&#34;], // [电影ID, 电影名称] [3565, &#34;Where the Heart Is&#34;], // ... 更多历史观看记录，⻓度不定 ], &#34;target_item&#34;: [1893, &#34;Beyond Silence&#34;], // ⽤⼾实际观看的下⼀部电影 [电影ID, 电影名称] &#34;candidates&#34;: [ // 推荐系统召回阶段得到的候选电影列表 [2492, &#34;20 Dates&#34;], [684, &#34;Windows&#34;], [1893, &#34;Beyond Silence&#34;], // 包含⽤⼾实际观看的下⼀部电影 // ... 更多候选电影，⻓度不定，⼀般为20个左右 ] } 我们需要将candidates列表按照匹配度进行重排序，列表第一个元素是最有可能（最喜欢）观看的电影，列表最后一个是最不可能（最不喜欢）的电影。">
  <meta itemprop="datePublished" content="2025-05-12T11:00:59-04:00">
  <meta itemprop="dateModified" content="2025-05-12T11:00:59-04:00">
  <meta itemprop="wordCount" content="1350">
  <meta itemprop="keywords" content="考试">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="上海创智学院2025PE考试">
  <meta name="twitter:description" content="注意：提示词都是用中文编写，若将中文直接翻译成英文，效果可能下降。
任务理解 给定数据结构如下所示的数据：
val.jsonl中，每⼀条数据的字段说明： { &#34;user_id&#34;: 5737, // ⽤⼾编号 &#34;item_list&#34;: [ // ⽤⼾历史观看电影列表，按时间顺序排列，越靠后表⽰越近期观看 [1836, &#34;Last Days of Disco, The&#34;], // [电影ID, 电影名称] [3565, &#34;Where the Heart Is&#34;], // ... 更多历史观看记录，⻓度不定 ], &#34;target_item&#34;: [1893, &#34;Beyond Silence&#34;], // ⽤⼾实际观看的下⼀部电影 [电影ID, 电影名称] &#34;candidates&#34;: [ // 推荐系统召回阶段得到的候选电影列表 [2492, &#34;20 Dates&#34;], [684, &#34;Windows&#34;], [1893, &#34;Beyond Silence&#34;], // 包含⽤⼾实际观看的下⼀部电影 // ... 更多候选电影，⻓度不定，⼀般为20个左右 ] } 我们需要将candidates列表按照匹配度进行重排序，列表第一个元素是最有可能（最喜欢）观看的电影，列表最后一个是最不可能（最不喜欢）的电影。">

	
  </head><body class="ma0 avenir bg-near-white development">

    
   
  

  
  
  
  <header class="cover bg-center" style="background-image: url('http://localhost:1313/images/PE2025/pi.jpg');">
    <div class="bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        HomePage
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/about/" title="About ME page">
              About ME
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/post/" title="Articles page">
              Articles
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/contact/" title="Contact page">
              Contact
            </a>
          </li>
          
        </ul>
      
      <div class="ananke-socials"><a href="https://www.facebook.com/patrick.kollitsch" target="_blank" rel="noopener"
        class="ananke-social-link link-transition facebook link dib z-999 pt3 pt0-l mr1"
        title="follow on Facebook - Opens in a new window"
        aria-label="follow on Facebook - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256C0 376 82.7 476.8 194.2 504.5V334.2H141.4V256h52.8V222.3c0-87.1 39.4-127.5 125-127.5c16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1c-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287V510.1C413.8 494.8 512 386.9 512 256h0z"/></svg>
            
          </span></a><a href="https://bsky.app/profile/kollitsch.dev" target="_blank" rel="noopener"
        class="ananke-social-link link-transition bluesky link dib z-999 pt3 pt0-l mr1"
        title="follow on Bluesky - Opens in a new window"
        aria-label="follow on Bluesky - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M407.8 294.7c-3.3-.4-6.7-.8-10-1.3c3.4 .4 6.7 .9 10 1.3zM288 227.1C261.9 176.4 190.9 81.9 124.9 35.3C61.6-9.4 37.5-1.7 21.6 5.5C3.3 13.8 0 41.9 0 58.4S9.1 194 15 213.9c19.5 65.7 89.1 87.9 153.2 80.7c3.3-.5 6.6-.9 10-1.4c-3.3 .5-6.6 1-10 1.4C74.3 308.6-9.1 342.8 100.3 464.5C220.6 589.1 265.1 437.8 288 361.1c22.9 76.7 49.2 222.5 185.6 103.4c102.4-103.4 28.1-156-65.8-169.9c-3.3-.4-6.7-.8-10-1.3c3.4 .4 6.7 .9 10 1.3c64.1 7.1 133.6-15.1 153.2-80.7C566.9 194 576 75 576 58.4s-3.3-44.7-21.6-52.9c-15.8-7.1-40-14.9-103.2 29.8C385.1 81.9 314.1 176.4 288 227.1z"/></svg>
            
          </span></a><a href="http://linkedin.com/in/patrickkollitsch" target="_blank" rel="noopener"
        class="ananke-social-link link-transition linkedin link dib z-999 pt3 pt0-l mr1"
        title="follow on LinkedIn - Opens in a new window"
        aria-label="follow on LinkedIn - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
            
          </span></a></div>

    </div>
  </div>
</nav>

      <div class="tc-l pv6 ph3 ph4-ns">
        
          <div class="f2 f1-l fw2 white-90 mb0 lh-title">上海创智学院2025PE考试</div>
          
        
      </div>
    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Articles
      </aside><div id="sharing" class="mt3 ananke-socials"><a href="mailto:?&amp;body=http%3A%2F%2Flocalhost%3A1313%2Fpost%2F%25E4%25B8%258A%25E6%25B5%25B7%25E5%2588%259B%25E6%2599%25BA%25E5%25AD%25A6%25E9%2599%25A22025pe%25E8%2580%2583%25E8%25AF%2595%2F&amp;subject=%E4%B8%8A%E6%B5%B7%E5%88%9B%E6%99%BA%E5%AD%A6%E9%99%A22025PE%E8%80%83%E8%AF%95"
        class="ananke-social-link email no-underline"
        title="Share on Email" aria-label="Share on Email"
        target="_blank" rel="nofollow noopener noreferrer">
        <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M64 112c-8.8 0-16 7.2-16 16l0 22.1L220.5 291.7c20.7 17 50.4 17 71.1 0L464 150.1l0-22.1c0-8.8-7.2-16-16-16L64 112zM48 212.2L48 384c0 8.8 7.2 16 16 16l384 0c8.8 0 16-7.2 16-16l0-171.8L322 328.8c-38.4 31.5-93.7 31.5-132 0L48 212.2zM0 128C0 92.7 28.7 64 64 64l384 0c35.3 0 64 28.7 64 64l0 256c0 35.3-28.7 64-64 64L64 448c-35.3 0-64-28.7-64-64L0 128z"/></svg>
                
              </span></a><a href="https://facebook.com/sharer/sharer.php?&amp;u=http%3A%2F%2Flocalhost%3A1313%2Fpost%2F%25E4%25B8%258A%25E6%25B5%25B7%25E5%2588%259B%25E6%2599%25BA%25E5%25AD%25A6%25E9%2599%25A22025pe%25E8%2580%2583%25E8%25AF%2595%2F"
        class="ananke-social-link facebook no-underline"
        title="Share on Facebook" aria-label="Share on Facebook"
        target="_blank" rel="nofollow noopener noreferrer">
        <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256C0 376 82.7 476.8 194.2 504.5V334.2H141.4V256h52.8V222.3c0-87.1 39.4-127.5 125-127.5c16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1c-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287V510.1C413.8 494.8 512 386.9 512 256h0z"/></svg>
                
              </span></a><a href="https://bsky.app/intent/compose?&amp;text=http%3A%2F%2Flocalhost%3A1313%2Fpost%2F%25E4%25B8%258A%25E6%25B5%25B7%25E5%2588%259B%25E6%2599%25BA%25E5%25AD%25A6%25E9%2599%25A22025pe%25E8%2580%2583%25E8%25AF%2595%2F"
        class="ananke-social-link bluesky no-underline"
        title="Share on Bluesky" aria-label="Share on Bluesky"
        target="_blank" rel="nofollow noopener noreferrer">
        <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M407.8 294.7c-3.3-.4-6.7-.8-10-1.3c3.4 .4 6.7 .9 10 1.3zM288 227.1C261.9 176.4 190.9 81.9 124.9 35.3C61.6-9.4 37.5-1.7 21.6 5.5C3.3 13.8 0 41.9 0 58.4S9.1 194 15 213.9c19.5 65.7 89.1 87.9 153.2 80.7c3.3-.5 6.6-.9 10-1.4c-3.3 .5-6.6 1-10 1.4C74.3 308.6-9.1 342.8 100.3 464.5C220.6 589.1 265.1 437.8 288 361.1c22.9 76.7 49.2 222.5 185.6 103.4c102.4-103.4 28.1-156-65.8-169.9c-3.3-.4-6.7-.8-10-1.3c3.4 .4 6.7 .9 10 1.3c64.1 7.1 133.6-15.1 153.2-80.7C566.9 194 576 75 576 58.4s-3.3-44.7-21.6-52.9c-15.8-7.1-40-14.9-103.2 29.8C385.1 81.9 314.1 176.4 288 227.1z"/></svg>
                
              </span></a><a href="https://www.linkedin.com/shareArticle?&amp;mini=true&amp;source=http%3A%2F%2Flocalhost%3A1313%2Fpost%2F%25E4%25B8%258A%25E6%25B5%25B7%25E5%2588%259B%25E6%2599%25BA%25E5%25AD%25A6%25E9%2599%25A22025pe%25E8%2580%2583%25E8%25AF%2595%2F&amp;summary=&#43;%E6%B3%A8%E6%84%8F%EF%BC%9A%E6%8F%90%E7%A4%BA%E8%AF%8D%E9%83%BD%E6%98%AF%E7%94%A8%E4%B8%AD%E6%96%87%E7%BC%96%E5%86%99%EF%BC%8C%E8%8B%A5%E5%B0%86%E4%B8%AD%E6%96%87%E7%9B%B4%E6%8E%A5%E7%BF%BB%E8%AF%91%E6%88%90%E8%8B%B1%E6%96%87%EF%BC%8C%E6%95%88%E6%9E%9C%E5%8F%AF%E8%83%BD%E4%B8%8B%E9%99%8D%E3%80%82%0A%E4%BB%BB%E5%8A%A1%E7%90%86%E8%A7%A3&#43;%E7%BB%99%E5%AE%9A%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A6%82%E4%B8%8B%E6%89%80%E7%A4%BA%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%9A%0Aval.jsonl%E4%B8%AD%EF%BC%8C%E6%AF%8F%E2%BC%80%E6%9D%A1%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AD%97%E6%AE%B5%E8%AF%B4%E6%98%8E%EF%BC%9A&#43;%7B&#43;%26amp%3B%2334%3Buser_id%26amp%3B%2334%3B%3A&#43;5737%2C&#43;%2F%2F&#43;%E2%BD%A4%E2%BC%BE%E7%BC%96%E5%8F%B7&#43;%26amp%3B%2334%3Bitem_list%26amp%3B%2334%3B%3A&#43;%5B&#43;%2F%2F&#43;%E2%BD%A4%E2%BC%BE%E5%8E%86%E5%8F%B2%E8%A7%82%E7%9C%8B%E7%94%B5%E5%BD%B1%E5%88%97%E8%A1%A8%EF%BC%8C%E6%8C%89%E6%97%B6%E9%97%B4%E9%A1%BA%E5%BA%8F%E6%8E%92%E5%88%97%EF%BC%8C%E8%B6%8A%E9%9D%A0%E5%90%8E%E8%A1%A8%E2%BD%B0%E8%B6%8A%E8%BF%91%E6%9C%9F%E8%A7%82%E7%9C%8B&#43;%5B1836%2C&#43;%26amp%3B%2334%3BLast&#43;Days&#43;of&#43;Disco%2C&#43;The%26amp%3B%2334%3B%5D%2C&#43;%2F%2F&#43;%5B%E7%94%B5%E5%BD%B1ID%2C&#43;%E7%94%B5%E5%BD%B1%E5%90%8D%E7%A7%B0%5D&#43;%5B3565%2C&#43;%26amp%3B%2334%3BWhere&#43;the&#43;Heart&#43;Is%26amp%3B%2334%3B%5D%2C&#43;%2F%2F&#43;...&#43;%E6%9B%B4%E5%A4%9A%E5%8E%86%E5%8F%B2%E8%A7%82%E7%9C%8B%E8%AE%B0%E5%BD%95%EF%BC%8C%E2%BB%93%E5%BA%A6%E4%B8%8D%E5%AE%9A&#43;%5D%2C&#43;%26amp%3B%2334%3Btarget_item%26amp%3B%2334%3B%3A&#43;%5B1893%2C&#43;%26amp%3B%2334%3BBeyond&#43;Silence%26amp%3B%2334%3B%5D%2C&#43;%2F%2F&#43;%E2%BD%A4%E2%BC%BE%E5%AE%9E%E9%99%85%E8%A7%82%E7%9C%8B%E7%9A%84%E4%B8%8B%E2%BC%80%E9%83%A8%E7%94%B5%E5%BD%B1&#43;%5B%E7%94%B5%E5%BD%B1ID%2C&#43;%E7%94%B5%E5%BD%B1%E5%90%8D%E7%A7%B0%5D&#43;%26amp%3B%2334%3Bcandidates%26amp%3B%2334%3B%3A&#43;%5B&#43;%2F%2F&#43;%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%8F%AC%E5%9B%9E%E9%98%B6%E6%AE%B5%E5%BE%97%E5%88%B0%E7%9A%84%E5%80%99%E9%80%89%E7%94%B5%E5%BD%B1%E5%88%97%E8%A1%A8&#43;%5B2492%2C&#43;%26amp%3B%2334%3B20&#43;Dates%26amp%3B%2334%3B%5D%2C&#43;%5B684%2C&#43;%26amp%3B%2334%3BWindows%26amp%3B%2334%3B%5D%2C&#43;%5B1893%2C&#43;%26amp%3B%2334%3BBeyond&#43;Silence%26amp%3B%2334%3B%5D%2C&#43;%2F%2F&#43;%E5%8C%85%E5%90%AB%E2%BD%A4%E2%BC%BE%E5%AE%9E%E9%99%85%E8%A7%82%E7%9C%8B%E7%9A%84%E4%B8%8B%E2%BC%80%E9%83%A8%E7%94%B5%E5%BD%B1&#43;%2F%2F&#43;...&#43;%E6%9B%B4%E5%A4%9A%E5%80%99%E9%80%89%E7%94%B5%E5%BD%B1%EF%BC%8C%E2%BB%93%E5%BA%A6%E4%B8%8D%E5%AE%9A%EF%BC%8C%E2%BC%80%E8%88%AC%E4%B8%BA20%E4%B8%AA%E5%B7%A6%E5%8F%B3&#43;%5D&#43;%7D&#43;%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E5%B0%86candidates%E5%88%97%E8%A1%A8%E6%8C%89%E7%85%A7%E5%8C%B9%E9%85%8D%E5%BA%A6%E8%BF%9B%E8%A1%8C%E9%87%8D%E6%8E%92%E5%BA%8F%EF%BC%8C%E5%88%97%E8%A1%A8%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%85%83%E7%B4%A0%E6%98%AF%E6%9C%80%E6%9C%89%E5%8F%AF%E8%83%BD%EF%BC%88%E6%9C%80%E5%96%9C%E6%AC%A2%EF%BC%89%E8%A7%82%E7%9C%8B%E7%9A%84%E7%94%B5%E5%BD%B1%EF%BC%8C%E5%88%97%E8%A1%A8%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E6%98%AF%E6%9C%80%E4%B8%8D%E5%8F%AF%E8%83%BD%EF%BC%88%E6%9C%80%E4%B8%8D%E5%96%9C%E6%AC%A2%EF%BC%89%E7%9A%84%E7%94%B5%E5%BD%B1%E3%80%82%0A&amp;title=%E4%B8%8A%E6%B5%B7%E5%88%9B%E6%99%BA%E5%AD%A6%E9%99%A22025PE%E8%80%83%E8%AF%95&amp;url=http%3A%2F%2Flocalhost%3A1313%2Fpost%2F%25E4%25B8%258A%25E6%25B5%25B7%25E5%2588%259B%25E6%2599%25BA%25E5%25AD%25A6%25E9%2599%25A22025pe%25E8%2580%2583%25E8%25AF%2595%2F"
        class="ananke-social-link linkedin no-underline"
        title="Share on LinkedIn" aria-label="Share on LinkedIn"
        target="_blank" rel="nofollow noopener noreferrer">
        <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
                
              </span></a></div>
<h1 class="f1 athelas mt3 mb1">上海创智学院2025PE考试</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2025-05-12T11:00:59-04:00">May 12, 2025</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><blockquote>
<p>注意：提示词都是用中文编写，若将中文直接翻译成英文，效果可能下降。</p>
</blockquote>
<h3 id="任务理解">任务理解</h3>
<hr>
<p>给定数据结构如下所示的数据：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">val.jsonl中，每⼀条数据的字段说明：</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;user_id&#34;</span>: <span style="color:#ae81ff">5737</span>, <span style="color:#75715e">// ⽤⼾编号
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#f92672">&#34;item_list&#34;</span>: [ <span style="color:#75715e">// ⽤⼾历史观看电影列表，按时间顺序排列，越靠后表⽰越近期观看
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    [<span style="color:#ae81ff">1836</span>, <span style="color:#e6db74">&#34;Last Days of Disco, The&#34;</span>], <span style="color:#75715e">// [电影ID, 电影名称]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    [<span style="color:#ae81ff">3565</span>, <span style="color:#e6db74">&#34;Where the Heart Is&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ... 更多历史观看记录，⻓度不定
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;target_item&#34;</span>: [<span style="color:#ae81ff">1893</span>, <span style="color:#e6db74">&#34;Beyond Silence&#34;</span>], <span style="color:#75715e">// ⽤⼾实际观看的下⼀部电影 [电影ID, 电影名称]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#f92672">&#34;candidates&#34;</span>: [ <span style="color:#75715e">// 推荐系统召回阶段得到的候选电影列表
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    [<span style="color:#ae81ff">2492</span>, <span style="color:#e6db74">&#34;20 Dates&#34;</span>],
</span></span><span style="display:flex;"><span>    [<span style="color:#ae81ff">684</span>, <span style="color:#e6db74">&#34;Windows&#34;</span>],
</span></span><span style="display:flex;"><span>    [<span style="color:#ae81ff">1893</span>, <span style="color:#e6db74">&#34;Beyond Silence&#34;</span>], <span style="color:#75715e">// 包含⽤⼾实际观看的下⼀部电影
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// ... 更多候选电影，⻓度不定，⼀般为20个左右
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>我们需要将candidates列表按照匹配度进行重排序，列表第一个元素是最有可能（最喜欢）观看的电影，列表最后一个是最不可能（最不喜欢）的电影。</p>
<p>根据题目所述，“考生需要分析用户的历史观影⾏为，从中挖掘用户偏好特征，并将这些信息合理地融⼊提示词中，使大语言模型能够对候选电影进行准确排序。”，我们将任务拆结成：</p>
<ol>
<li>分析用户观影行为</li>
<li>挖掘用户偏好特征</li>
<li>将用户观影行为和用户偏好特征融入到提示词中，使得大语言模型更准确</li>
</ol>
<p> </p>
<h3 id="ndcg指标">NDCG指标</h3>
<hr>
<p>采用$NDCG@KNormalized Discounted Cumulative Gain$评价。NDCG值范围为[0,1]，越接近1表示排序质量越高。</p>
<p>具体来说，给定一个预测的排序列表 $p = [p_1, p_2, &hellip;, p_k]$ 和用户实际观看的下一部电影 $g$，我们计算NDCG如下：</p>
<ol>
<li>相关性评分：对预测列表中的每个电影 $p_i$，如果 $p_i = g$，则相关性 $rel_i = 1$；否则 $rel_i = 0$</li>
<li>折损累积收益$DCG$：$DCG@k = \sum_{i=1}^{k} \frac{rel_i}{\log_2$i+1$}$</li>
<li>理想折损累积收益$IDCG$：在本任务中，由于只有一个相关项，理想情况是将其放在第一位。因此： $$ IDCG@k = \frac{1}{\log_2$1+1$} = 1$ $$</li>
<li>归一化折损累积收益$NDCG$：$NDCG@k = \frac{DCG@k}{IDCG@k} = DCG@k$</li>
</ol>
<p> </p>
<h3 id="最佳提示词oneshot-recprompt">最佳提示词OneShot-RecPrompt</h3>
<hr>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>system_message <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;system&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;你是一位电影推荐专家模型，任务是根据用户最近的观影行为预测其下一部最可能观看的电影，&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;并对给定的候选电影列表进行精准排序，输出推荐强度从高到低的电影ID数组，以最大化排序评估指标NDCG@10。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;【排序目标】</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 推荐重点在于预测真实用户行为，而非泛兴趣匹配；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 候选列表中**包含真实目标电影**，应最大程度地将其排序前置，确保NDCG@10达到或超过0.8。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;【推荐逻辑流程】</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;1. 提取用户最近3部观影记录中的偏好特征（类型、题材、情绪氛围、导演风格），形成兴趣画像；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;2. 对每部候选电影构建对应的四维内容标签，需基于真实内容描述，不可仅依标题推测；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;3. 计算候选电影与用户兴趣的匹配程度，生成推荐强度；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;4. 综合排序逻辑如下：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   - 【强匹配】：类型+题材完全一致，风格/情绪贴合 → 排前2位；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   - 【中匹配】：类型或题材匹配，且有风格或情绪相似点 → 排第3-5位；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   - 【容错匹配】：风格或情绪较接近，但题材创新或偏离主流兴趣 → 排第6-8位；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   - 【弱匹配】：标签脱节，风格差异大，与近期行为不符 → 排末位；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   - 若候选项虽匹配度不强但有潜在行为目标特征（如冷门探索、片单延续等），允许其容错前移排序。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;【强化要求】</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 对真实目标电影（若能识别）应排序在前3位；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 对内容标签缺失或类型模糊的电影，需根据剧情、氛围、设定合理推理填补；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 不得基于标题或流行度主观推测，应以结构化分析为准。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;【输出格式】</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 输出格式必须为JSON数组；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 数组内容仅含候选电影ID，顺序表示推荐强度，由高到低；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 禁止任何解释、注释或标签信息；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 示例输出：[522, 706, 554, 738, 659, 729, 751, 405, 549, 475]&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    user_message <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;user&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;请根据以下用户的观影记录，预测其当前偏好，并对候选电影进行排序：</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【用户ID】：</span><span style="color:#e6db74">{</span>user_id<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【观影历史】（按时间排序，越后越近期）：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>history_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【候选电影列表】：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>candidate_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;任务要求：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 提取最近3部电影中的偏好特征（类型/题材/情绪/风格）。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 为每部候选电影生成内容标签并比对。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 排序目标是预测用户的下一部观看行为，而不仅仅是相似兴趣。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 候选中包含用户真实观看的目标电影，请尽量将其排在前列，但也要考虑整体匹配逻辑。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 输出格式为JSON数组，长度与候选电影数量一致，仅包含ID，如：[2492, 684, 738, ...]。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 禁止输出任何解释、标签或注释内容。&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p> </p>
<h3 id="提示词所使用的技术">提示词所使用的技术</h3>
<ul>
<li>明确排序是<strong>预测下一部电影行为</strong>而非仅兴趣相似性（行为导向化）</li>
<li>指出“候选中包含目标电影”，鼓励靠前排序但不硬性要求（软性目标电影引导）</li>
<li>分3步：偏好提取 → 标签生成 → 匹配比对 → 排序（思维链技术）</li>
<li>输出必须等于候选长度，禁止注释或标签（明确输出格式和长度控制）</li>
<li>固定“最近3部电影”为兴趣源，非模糊泛化（偏好提取来源清晰）</li>
<li>明确指出“略偏离兴趣也可能是目标”（容忍合理探索）</li>
</ul>
<h3 id="-符合短期兴趣漂移实际规律">① 符合“短期兴趣漂移”实际规律</h3>
<ul>
<li>用户最近3部电影往往才是“接下来行为”的核心决定因子。</li>
<li>模型聚焦当前兴趣而非全历史，显著提升了命中率。</li>
</ul>
<h3 id="-补足了传统推荐系统的符号盲区">② 补足了传统推荐系统的“符号盲区”</h3>
<ul>
<li>传统模型（如协同过滤、FM）很难捕捉“类型/情绪/风格”这类复杂偏好组合。</li>
<li>本提示词强制LLM（测试中使用**<a href="https://zhida.zhihu.com/search?content_id=726833489&amp;content_type=Answer&amp;match_order=1&amp;q=deepseek&#43;v3&amp;zhida_source=entity">deepseek v3</a>**）<strong>显式生成这些标签</strong>，实现类语义建模。</li>
</ul>
<h3 id="-允许兴趣-行为不完全一致">③ 允许“兴趣-行为不完全一致”</h3>
<ul>
<li>考虑到真实目标电影风格变化较大，若只是靠“兴趣近似”排序，目标可能掉队。</li>
<li>本提示词用软引导机制避免这种漏排问题。</li>
</ul>
<h3 id="-强格式约束降低输出偏差">④ 强格式约束降低输出偏差</h3>
<ul>
<li>控制输出 JSON 格式、长度、无解释，防止模型跑偏。</li>
<li>尤其重要于推荐系统的“批量离线评分”。</li>
</ul>
<p> </p>
<h3 id="实验">实验</h3>
<hr>
<h3 id="实验设计">实验设计</h3>
<p>实验基于官方提供的函数计算指标，取<strong>5个epoch</strong>的平均值作为一次测试的结果，所调用的api为<strong>deepseek v3</strong>。</p>
<h3 id="总体实验">总体实验</h3>
<p>共设计了10组提示词（具体见提示词效果（code+result）），在统一设备上运行多次取平均值得到的结果，可以看出<strong>OneShot-RecPrompt</strong>效果最佳。</p>
<table>
  <thead>
      <tr>
          <th>Model_name</th>
          <th>NDCG</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><a href="https://zhida.zhihu.com/search?content_id=726833489&amp;content_type=Answer&amp;match_order=1&amp;q=Multi-Turn-v1&amp;zhida_source=entity">Multi-Turn-v1</a></td>
          <td>0.281</td>
      </tr>
      <tr>
          <td>Multi-Turn-v2</td>
          <td>0.345</td>
      </tr>
      <tr>
          <td>Multi-Turn-v3</td>
          <td>0.331</td>
      </tr>
      <tr>
          <td>Multi-Turn-v4</td>
          <td>0.428</td>
      </tr>
      <tr>
          <td>Single-Turn-v1</td>
          <td>0.554</td>
      </tr>
      <tr>
          <td><a href="https://zhida.zhihu.com/search?content_id=726833489&amp;content_type=Answer&amp;match_order=1&amp;q=chain-of-thought-v1&amp;zhida_source=entity">chain-of-thought-v1</a></td>
          <td>0.616</td>
      </tr>
      <tr>
          <td>label_guidance_v1</td>
          <td>0.494</td>
      </tr>
      <tr>
          <td>label_guidance_v2</td>
          <td>0.536</td>
      </tr>
      <tr>
          <td>label_guidance_v3</td>
          <td>0.540</td>
      </tr>
      <tr>
          <td>OneShot-RecPrompt</td>
          <td>0.643</td>
      </tr>
  </tbody>
</table>
<p> </p>
<h3 id="多轮对话设计-vs-单步对话设计">多轮对话设计 vs. 单步对话设计</h3>
<blockquote>
<p>这部分实验主要想探索基于多轮对话设计的电影推荐系统合适，还是基于单轮对话的电影推荐系统合适？</p>
</blockquote>
<p>对于多轮对话，每轮对话的第一版提示词Multi-Turn-v1如下：</p>
<ol>
<li>请你作为电影评论专家，生成历史电影概述</li>
<li>请你作为电影评论专家，生成候选电影概述</li>
<li>你是一个电影爱好者，你会根据用户的观影历史，分析用户近期观影偏好</li>
<li>你是一位电影推荐专家模型，任务是根据用户观影历史，根据匹配度对候选电影列表进行排序</li>
</ol>
<p>在这里一共做了5组实验，包括：</p>
<ol>
<li>Multi-Turn-v1（无润色，纯手写）</li>
<li>Multi-Turn-v2（让deepseek v1润色过一遍的Multi-Turn-v1）</li>
<li>Multi-Turn-v3（让deepseek v1润色过一遍的Multi-Turn-v2）</li>
<li>Multi-Turn-v4（让deepseek v1润色过一遍的Multi-Turn-v3）</li>
<li>基线提示词Single-Turn-v1</li>
</ol>
<table>
  <thead>
      <tr>
          <th>Model</th>
          <th>NDCG</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Multi-Turn-v1（已附上）</td>
          <td>0.281</td>
      </tr>
      <tr>
          <td>Multi-Turn-v2</td>
          <td>0.345</td>
      </tr>
      <tr>
          <td>Multi-Turn-v3</td>
          <td>0.331</td>
      </tr>
      <tr>
          <td>Multi-Turn-v4（已附上）</td>
          <td>0.428</td>
      </tr>
      <tr>
          <td>Single-Turn-v1（已附上）</td>
          <td>0.554</td>
      </tr>
  </tbody>
</table>
<p>根据实验表格可以发现简单的多步调试在电影推荐中效果并不佳，电影推荐任务本质上是“结构化预测排序”问题，单轮长 prompt 更有利于模型精准理解任务边界与排序逻辑，提升一致性与命中率。此外，调试难度大，token消耗数量几何式上升，同时调用时间约等于调用次数*一次调用时间。这里分为4轮对话，时间基本上单轮对话的4倍。从工程角度，为一个用户的一次推荐花去如此多token和时间是不划算的，所以后续我们重点探索单步推荐提示词。</p>
<p> </p>
<h3 id="有思维链-vs-无思维链">有思维链 vs. 无思维链</h3>
<blockquote>
<p>这部分实验主要想探索基于思维链的电影推荐系统合适，还是不基于的电影推荐系统合适？</p>
</blockquote>
<table>
  <thead>
      <tr>
          <th>维度</th>
          <th>chain-of-thought-v1（已附上）</th>
          <th>Single-Turn-v1（已附上）</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>任务目标表达</td>
          <td>强调分析行为 + 挖掘偏好 + 知识库补充 + 顺序重排</td>
          <td>简化为仅根据历史进行排序</td>
      </tr>
      <tr>
          <td>信息源定义</td>
          <td>引入了“知识库对历史电影的内容理解”作为辅助</td>
          <td>完全依赖用户提供的观影历史本身</td>
      </tr>
      <tr>
          <td>用户画像建构引导</td>
          <td>明确要求模型先进行行为分析与偏好建模</td>
          <td>没有提示偏好提取，直接排序</td>
      </tr>
      <tr>
          <td>提示词粒度</td>
          <td>行为 → 偏好 → 匹配 → 排序</td>
          <td>偏“单步指令”：历史 → 排序</td>
      </tr>
      <tr>
          <td>NDCG</td>
          <td>0.616</td>
          <td>0.554</td>
      </tr>
  </tbody>
</table>
<p>根据设计差异和实验表格可以，chain-of-thought-v1之所以比Single-Turn-v1效果显著更好，是因为它将推荐排序建模为“行为预测”而非“兴趣回顾”，并且在思维路径、输出控制、信息利用和目标引导上形成了完整链条，真正模拟了推荐系统的思维方式。</p>
<p> </p>
<h3 id="行为预测导向-vs-标签匹配导向">行为预测导向 vs. 标签匹配导向</h3>
<table>
  <thead>
      <tr>
          <th>维度</th>
          <th>chain-of-thought-v1（已附上）</th>
          <th>label-guidance-v1（已附上）</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>排序目标表述</td>
          <td>明确是“预测用户下一步可能观看的电影”</td>
          <td>聚焦“识别用户偏好并匹配候选电影”</td>
      </tr>
      <tr>
          <td>模型执行策略</td>
          <td>倾向于行为预测排序（优先找出“下一个可能看的”）</td>
          <td>倾向于相似度排序（匹配兴趣画像）</td>
      </tr>
      <tr>
          <td>目标电影引导</td>
          <td>明确提到“候选中包含真实目标电影，应尽量靠前”</td>
          <td>未提及候选中有真实目标，无法 soft steer</td>
      </tr>
      <tr>
          <td>标签生成要求</td>
          <td>不强制生成标签，仅要求理解偏好 → 匹配 → 排序</td>
          <td>强制候选生成内容标签并比对用户偏好</td>
      </tr>
      <tr>
          <td>规则逻辑层级</td>
          <td>简洁明晰、强调输出结果合理性为主</td>
          <td>指令复杂、引导偏好分类准确为主</td>
      </tr>
      <tr>
          <td>风控约束</td>
          <td>更注重排序的行为解释一致性</td>
          <td>更注重类型/题材匹配的一致性</td>
      </tr>
      <tr>
          <td>NDCG</td>
          <td>0.616</td>
          <td>0.49445</td>
      </tr>
  </tbody>
</table>
<p>二者各有优劣，实验证明行为预测导向更适合电影推荐系统，二者应用区别如下所示：</p>
<table>
  <thead>
      <tr>
          <th>对比</th>
          <th>行为预测型（上轮）</th>
          <th>标签驱动型（本轮）</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>推荐系统用途</td>
          <td>精准预测点击/观看行为，提升 NDCG</td>
          <td>构建用户画像、探索兴趣结构</td>
      </tr>
      <tr>
          <td>优势</td>
          <td>强目标导向、利于准确命中目标电影</td>
          <td>强结构控制、模型更稳定执行规则</td>
      </tr>
      <tr>
          <td>风险</td>
          <td>若不控制好偏移会输出与兴趣冲突项</td>
          <td>若目标电影兴趣不一致则可能被排后</td>
      </tr>
  </tbody>
</table>
<p> </p>
<h3 id="强化逻辑链">强化逻辑链</h3>
<blockquote>
<p>对于电影推荐的优先级进行设定，让模型更加了解如何推荐。生成结果更加稳定</p>
</blockquote>
<table>
  <thead>
      <tr>
          <th>比较维度</th>
          <th>label-guidance-v1（已附上）</th>
          <th>label-guidance-v2（已附上）</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>任务描述方式</td>
          <td>强调结合知识库内容分析兴趣趋势</td>
          <td>强调“仅基于输入信息判断”</td>
      </tr>
      <tr>
          <td>样本控制力</td>
          <td>✅ 提及“近3部”为排序重点</td>
          <td>⚠️ 未指定近3部为偏好权重依据</td>
      </tr>
      <tr>
          <td>用户历史处理方式</td>
          <td>显式鼓励利用时间权重分析兴趣变化</td>
          <td>默认所有历史等权处理</td>
      </tr>
      <tr>
          <td>标签生成要求</td>
          <td>要求生成标签，但未定义格式结构</td>
          <td>明确给出标签结构 [剧情][成长][温暖][导演风格]</td>
      </tr>
      <tr>
          <td>排序规则层次</td>
          <td>逻辑链较弱，仅说明按匹配度排序</td>
          <td>✅ 明确四级排序优先级（强中弱弱）</td>
      </tr>
      <tr>
          <td>输出格式控制</td>
          <td>明确“只输出数组”，但写法偏自然语言</td>
          <td>✅ 强结构性（如“长度必须等于候选数量”）</td>
      </tr>
      <tr>
          <td>异常类型处理</td>
          <td>强调排除“未接触的类型/题材”</td>
          <td>✅ 更清晰规定“未接触”应排末尾</td>
      </tr>
      <tr>
          <td>NDCG</td>
          <td>0.494</td>
          <td>0.536</td>
      </tr>
  </tbody>
</table>
<p> </p>
<h3 id="预测-vs-排序">预测 vs. 排序</h3>
<blockquote>
<p>实际观看的影片数量规定为1，所以这个任务也可以定义成预测任务</p>
</blockquote>
<table>
  <thead>
      <tr>
          <th>维度</th>
          <th>label-guidance-v2（已附上）</th>
          <th>label-guidance-v3（已附上）</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>核心任务目标</td>
          <td>对候选电影做兴趣强度排序</td>
          <td>对候选电影做行为预测排序（预测“下一部”）</td>
      </tr>
      <tr>
          <td>偏好来源强调</td>
          <td>用户全体历史偏好，无特别指定近几部</td>
          <td>明确强调“最近3部”是主判断依据</td>
      </tr>
      <tr>
          <td>排序依据粒度</td>
          <td>按四维标签匹配（类型、题材、情绪、风格），且有分级排序策略</td>
          <td>同样四维匹配，但更关注行为趋势预测</td>
      </tr>
      <tr>
          <td>结构控制强度</td>
          <td>强：必须生成标签；匹配逻辑分层；数组输出长度必须等于候选数量</td>
          <td>中强：匹配规则清晰，但未显式要求标签结构或覆盖率</td>
      </tr>
      <tr>
          <td>目标电影提示</td>
          <td>不包含“真实下一部电影”提示语</td>
          <td>明确强调“候选中包含真实观看电影”，引导模型更偏向精排预测任务</td>
      </tr>
      <tr>
          <td>行为预测导向</td>
          <td>偏向兴趣评分（Personalized Ranking）</td>
          <td>更贴近 Click-through/行为预测（Next-item Prediction）任务</td>
      </tr>
      <tr>
          <td>约束控制（禁解释、格式）</td>
          <td>明确不准输出非数组格式</td>
          <td>同样控制，但稍少冗余约束性表达</td>
      </tr>
      <tr>
          <td>NDCG</td>
          <td>0.536</td>
          <td>0.540</td>
      </tr>
  </tbody>
</table>
<p>根据实验表示所示，二者效果差距不显著，所以这个任务既可以作为行为预测，也可以作为偏好排序</p>
<p> </p>
<h3 id="提示词效果展示coderesult">提示词效果展示（code+result）</h3>
<h3 id="single-turn-v1">single-turn-v1</h3>
<p>结果：0.57469</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>system_message <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;system&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;你是一位推荐系统中的智能重排助手，具备电影专家知识，&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;能够根据用户的观影历史，对候选电影列表进行偏好排序。&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;你的任务是：仅基于用户的历史记录，重排候选电影顺序，输出一个推荐强度从高到低的电影ID列表（JSON数组）。&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    user_message <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;user&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;请根据以下用户的观影历史信息，对候选电影进行排序。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【用户ID】：</span><span style="color:#e6db74">{</span>user_id<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【观影历史】（按时间顺序，越后越近期）：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>history_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【候选电影列表】：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>candidate_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;请输出排序后的电影ID列表（如：[1893, 684, 2492]）。只输出JSON数组，不要加入多余的解释。&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="multi-turn-v4">Multi-Turn-v4</h3>
<p>结果：0.42821</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">construct_prompt</span>(d):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    构造用于多轮对话的提示词列表
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    参数:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        d (dict): jsonl数据文件的一行，包含 item_list 和 candidates
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    返回:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        list: 包含四个提示词的列表，前三个是直接可用的消息字典，第四个是模板字符串
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    history <span style="color:#f92672">=</span> d[<span style="color:#e6db74">&#34;item_list&#34;</span>]
</span></span><span style="display:flex;"><span>    candidates <span style="color:#f92672">=</span> d[<span style="color:#e6db74">&#34;candidates&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 提取历史和候选电影的标题</span>
</span></span><span style="display:flex;"><span>    history_titles <span style="color:#f92672">=</span> [title <span style="color:#66d9ef">for</span> _, title <span style="color:#f92672">in</span> history]
</span></span><span style="display:flex;"><span>    candidate_titles <span style="color:#f92672">=</span> [title <span style="color:#66d9ef">for</span> _, title <span style="color:#f92672">in</span> candidates]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 提示词1：生成历史电影概述</span>
</span></span><span style="display:flex;"><span>    history_prompt <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;请你作为电影评论专家，对下列电影的名称，各用80到100字的中文，分别总结其剧情、风格、情感等方面，&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;严格用如下格式输出：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">电影名：XXX；概述：YYY</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;电影列表：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>join(history_titles)
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    prompt1 <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;user&#34;</span>, <span style="color:#e6db74">&#34;content&#34;</span>: history_prompt}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 提示词2：生成候选电影概述</span>
</span></span><span style="display:flex;"><span>    candidate_prompt <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;请你作为电影评论专家，对下列电影的名称，各用80到100字的中文，分别总结其剧情、风格、情感等方面，&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;严格用如下格式输出：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">电影名：XXX；概述：YYY</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;电影列表：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>join(candidate_titles)
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    prompt2 <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;user&#34;</span>, <span style="color:#e6db74">&#34;content&#34;</span>: candidate_prompt}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 提示词3：分析用户近期偏好</span>
</span></span><span style="display:flex;"><span>    recent_history <span style="color:#f92672">=</span> history[<span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>:]  <span style="color:#75715e"># 只关注最近5部电影</span>
</span></span><span style="display:flex;"><span>    recent_history_str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>join([<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;观影顺序</span><span style="color:#e6db74">{</span>rank<span style="color:#e6db74">}</span><span style="color:#e6db74">-电影名</span><span style="color:#e6db74">{</span>title<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">for</span> rank, (_, title) <span style="color:#f92672">in</span> enumerate(recent_history, start<span style="color:#f92672">=</span>len(history)<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>)])
</span></span><span style="display:flex;"><span>    man_like_prompt <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;你是一个电影爱好者，你会根据用户的观影历史（一个列表，其中元素内容为“观影顺序-电影名-电影概述”，观影顺序越靠后代表越近期观看），&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;分析用户的观影风格和口味。请你分析以下用户的观影风格和口味，输出一段大约200字的内容，概述他的近期偏好包括你判断的原因，&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;包括他的电影类型、题材、导演风格和情感基调。预测他后面会看什么类型的电影。以下是用户的观影历史：</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>recent_history_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;只输出关于用户近期偏好的内容，只输出一段文本，字数为200字，请按如下格式输出：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;这个用户近期喜欢观看...，这是因为...；他喜欢看...类型的电影，这是因为...；他喜欢看...风格的电影，这是因为...；&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;他喜欢看...情感的电影，这是因为...。&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    prompt3 <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;user&#34;</span>, <span style="color:#e6db74">&#34;content&#34;</span>: man_like_prompt}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 提示词4：最终推荐提示词</span>
</span></span><span style="display:flex;"><span>    final_prompt<span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;### 角色（Role）</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;你是一个个性化的电影推荐助手，具备电影专家的知识储备，能够分析用户的观影历史并理解其偏好。&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;你熟悉电影类型、题材、导演风格和情感基调，致力于为用户提供符合其口味的推荐。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;### 任务（Task）</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;根据用户提供的观影历史和近期偏好，对候选电影列表进行重排序。排序应反映用户的最可能喜好，&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;第一个电影是用户最可能观看的，最后一个是最不可能观看的。推荐必须完全基于用户的历史记录和近期偏好，&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;不得使用外部信息或主观假设。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;### 指导（Guidance）</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;请按照以下步骤和规则完成任务，确保推荐的准确性和逻辑性：</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;#### 1. 用户画像分析</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;- **重点关注**：优先分析用户近期观看的电影（时间排名 ≥ 15），因为这些更能反映当前偏好。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;- **分析维度**：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;  - **类型偏好**：统计历史中最常见的3种电影类型（剧情片、喜剧片、动作片、科幻片、恐怖片、悬疑片、爱情片、动画片）。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;  - **题材倾向**：提取电影的主题或关键词（如爱情、科幻、悬疑）。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;  - **风格特征**：关注导演风格或叙事手法（如幽默、紧张、写实）。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;  - **情感基调**：识别电影的情感倾向（如轻松、励志、悲伤）。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;  - **文化元素**：注意外语片或特定国家电影的出现频率。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;- **时间权重**：为历史中的每部电影分配权重，公式为 `1 + 0.1 * 时间排名`，近期电影权重更高。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;**用户观影历史（时间排名越大越近期），格式为：&#39;时间排名-电影名-电影概述&#39;**：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{history_str}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;**用户近期偏好**：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{man_like}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;#### 2. 候选电影匹配</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;- **标签化**：为每部候选电影标注类型、题材、导演、主演和情感基调（如[轻松][浪漫]）。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;- **匹配度计算**：逐步比较候选电影与用户画像的匹配程度，基于类型、题材、风格等维度，记录匹配情况。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;- **排除规则**：过滤用户历史中从未出现的类型（如恐怖片、实验片），确保排除逻辑准确。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;**候选电影列表**，格式为：&#39;电影名-电影概述&#39;**：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{candidate_str}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;#### 3. 排序规则</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;- **优先级**：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;  1. 与近期偏好完全匹配的电影（类型和题材）。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;  2. 与历史中高频导演或主演匹配的电影。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;  3. 情感基调与用户偏好一致的电影。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;  4. 包含用户熟悉的文化元素的电影。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;  5. 将用户未接触过的类型排在最后。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;- **决策记录**：在排序时逐步应用规则，记录每一步的依据。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;### 输出（Output）</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;- **格式**：以JSON数组形式输出排序后的电影编号，如 `[3, 1, 4, 2]`，仅包含数字编号。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;- **要求**：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;  - 编号与候选电影列表一一对应，范围为1到</span><span style="color:#e6db74">{len_candidate_str}</span><span style="color:#e6db74">。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;  - 确保无重复或遗漏，输出前进行验证。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;- **示例**：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;```</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;[3, 1, 4, 2]</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;```</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;请严格遵循以上步骤，确保推荐结果准确且符合用户偏好。&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [prompt1, prompt2, prompt3, final_prompt]
</span></span></code></pre></div><h3 id="chain-of-thought-v1">chain-of-thought-v1</h3>
<p>结果：0.61610</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>system_message <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;system&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;你是一位推荐系统中的智能重排助手，很了解英语电影，具备电影专家知识，&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;能够根据用户的观影历史，对候选电影列表进行偏好排序。&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;你的任务是：基于用户的历史观影记录和知识库关于历史观影电影的内容，分析用户观影行为，挖掘用户偏好特征，最后重排候选电影顺序，输出一个推荐强度从高到低的电影ID列表（JSON数组）。&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    user_message <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;user&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;请根据以下用户的观影历史信息，分析用户观影行为，挖掘用户偏好特征，最后对候选电影进行排序。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【用户ID】：</span><span style="color:#e6db74">{</span>user_id<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【观影历史】（按时间顺序，越后越近期，越近越有参考价值）：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>history_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【候选电影列表】：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>candidate_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;请输出排序后的电影ID列表（如：[1893, 684, 2492]）。只输出JSON数组，不要加入多余的解释。&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="chain-of-thought-v2">chain-of-thought-v2</h3>
<blockquote>
<p>只加入一句：推荐强度越高的电影排在越前面，表示更可能被用户喜欢</p>
</blockquote>
<p>结果：0.64401</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>system_message <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;system&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;你是一位推荐系统中的智能重排助手，很了解英语电影，具备电影专家知识，&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;能够根据用户的观影历史，对候选电影列表进行偏好排序。&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;你的任务是：基于用户的历史观影记录和知识库关于历史观影电影的内容，分析用户观影行为，挖掘用户偏好特征，最后重排候选电影顺序，输出一个推荐强度从高到低的电影ID列表（JSON数组）。&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    user_message <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;user&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;请根据以下用户的观影历史信息，分析用户观影行为，挖掘用户偏好特征，最后对候选电影进行排序。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【用户ID】：</span><span style="color:#e6db74">{</span>user_id<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【观影历史】（按时间顺序，越后越近期，越近越有参考价值）：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>history_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【候选电影列表】：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>candidate_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34; 输出一个按推荐强度排序的电影ID列表，推荐强度越高的电影排在越前mian，表⽰更可能被用户喜欢。&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;请输出排序后的电影ID列表（如：[1893, 684, 2492]）。只输出JSON数组，不要加入多余的解释。&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="label-guidance-v1">label-guidance-v1</h3>
<p>Overall average NDCG@10 across all epochs = 0.49445</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>system_message<span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>       <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;system&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;你是一位具备电影专家知识的推荐系统重排助手，擅长基于用户观影历史识别其偏好特征，&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;包括类型、题材关键词、导演风格和情绪基调等，并基于此对候选电影进行个性化排序。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;你的任务是：**基于用户的历史观影数据**，结合知识库对每部历史电影的内容理解，分析兴趣趋势，&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;识别最有可能被用户喜欢的候选电影，**输出一个按推荐强度排序的电影ID编号数组**。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;请严格按照规则进行：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;1. 排序仅依据提供的观影历史与候选电影，**禁止使用外部信息或主观判断**；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;2. 每个候选电影需基于电影的情节内容生成标签（类型/题材/情绪/风格），**禁止直接基于标题联想标签**，用于匹配用户偏好；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;3. 排序优先级为：①类型+题材高度匹配，②风格/情绪基调匹配，③文化元素熟悉度；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;4. 将未曾观看过的电影类型、题材关键词、导演风格与情绪基调，放置到推荐列表的最后几位；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">，&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;4. 输出格式为JSON数组（仅包含候选电影的ID，按推荐顺序输出），不得含任何多余文本。&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    user_message <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;user&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;请对以下用户的候选电影列表进行推荐排序。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【用户ID】：</span><span style="color:#e6db74">{</span>user_id<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【用户观影历史】（按时间顺序，越后越近期，时间排名已标注）：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>history_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【候选电影列表】（按电影ID识别）：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>candidate_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【任务要求】：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 分析用户的历史观影行为，识别其偏好的电影类型、题材关键词、导演风格与情绪基调，特别是近3部电影；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 为每个候选电影联想生成标签（如：[剧情][家庭][温暖]），用于与用户偏好比对；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 按匹配度对候选电影排序，输出推荐强度从高到低的电影编号列表；</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;请输出排序后的电影ID列表（如：[1893, 684, 2492]）。只输出JSON数组，不要加入多余的解释。&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;禁止加入解释说明。&#34;</span>
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>        }
</span></span></code></pre></div><h3 id="label-guidance-v2">label-guidance-v2</h3>
<blockquote>
<p>相比于v1更加强调逻辑链</p>
</blockquote>
<p>Overall average NDCG@10 across all epochs = 0.53604</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>system_message <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;system&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;你是一位具备电影专家知识的推荐系统重排助手，专注于根据用户的观影历史，识别其偏好特征，&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;包括常见的电影类型、题材关键词、导演风格与情绪基调，并对候选电影进行个性化偏好排序。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;你的任务是：仅基于用户提供的观影历史和候选电影列表，分析用户的兴趣趋势，推测最有可能被其喜欢的电影，&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;输出一个按推荐强度从高到低排序的电影ID数组。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;【必须遵循以下规则】：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;1. 仅使用输入信息进行判断，不得引用外部知识或虚构背景内容。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;2. 每部候选电影必须生成标签（类型、题材、风格、情绪），用于匹配。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   - 如：[剧情][成长][温暖][女性导演]</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;3. 排序优先级：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   (1) 同时匹配类型+题材的优先；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   (2) 情绪基调或导演风格相似者次之；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   (3) 用户曾频繁接触的文化背景加分；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   (4) 从未接触的标签维度电影，排在末尾。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;4. 输出格式：只输出JSON数组（如：[最推荐电影的ID, 第二推荐的电影的ID, 第三推荐的电影的ID，...，最不推荐的电影的ID]），每个数字为候选电影的ID。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   - 禁止包含解释、注释或其他文本。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   - 输出数组长度必须等于候选电影数量。&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    user_message <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;user&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;请对以下用户的候选电影列表进行推荐排序：</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【用户ID】：</span><span style="color:#e6db74">{</span>user_id<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【观影历史】（按时间顺序，越后越近期）：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>history_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【候选电影列表】（按电影ID识别）：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>candidate_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;请依照以下步骤完成任务：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;1. 提取用户近期观影中偏好的类型、题材、风格和情绪特征；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;2. 为每个候选电影生成标签，用于比对是否符合用户近期观影偏好，符合用户观影行为；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;3. 按匹配度高低进行排序，输出一个只含候选电影ID的JSON数组，如：[最推荐电影的ID, 第二推荐的电影的ID, 第三推荐的电影的ID，...，最不推荐的电影的ID]。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;请勿输出除JSON数组以外的任何内容。&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="label-guidance-v3">label-guidance-v3</h3>
<blockquote>
<p>相比于v2更侧重于预测</p>
</blockquote>
<p>Overall average NDCG@10 across all epochs = 0.54047</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>ystem_message <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;system&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;你是一位具备电影专家知识的大语言模型，任务是预测用户最可能接下来观看的电影，&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;通过分析用户历史观影行为，对候选电影列表进行排序，找出用户最可能选择的下一部电影。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;你必须只依据输入信息完成任务：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;1. 用户的观影历史按时间排序，后面的电影更接近当前兴趣，请重点分析最近三部电影的类型、题材、导演风格和情绪基调。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;2. 对每部候选电影，基于其可能的内容生成标签：[类型][题材][情绪][风格]。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;3. 逐项比对每个候选电影与近期观影兴趣的匹配程度：匹配越多，应排得越靠前。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;4. 注意：候选列表中包含用户实际观看的下一部电影，你的排序结果应尽量将其排在最前，提升准确率。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;5. 输出格式：只输出一个JSON数组，内容为候选电影的ID编号，如：[最推荐电影的ID, 第二推荐的电影的ID, 第三推荐的电影的ID，...，最不推荐的电影的ID]，禁止包含解释说明或多余文本。&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    user_message <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;user&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;请根据以下用户的观影历史，对候选电影进行排序，目标是预测其最有可能观看的下一部电影。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【用户ID】：</span><span style="color:#e6db74">{</span>user_id<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【观影历史】（按时间顺序，越后越近期）：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>history_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【候选电影列表】（按电影ID识别）：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>candidate_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;任务要求：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 分析最近三部电影的类型、题材、导演风格、情绪基调，作为用户当前偏好的核心。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 对每个候选电影生成标签并逐项比对，按匹配度排序。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 输出只包含候选电影ID的JSON数组，如：[最推荐电影的ID, 第二推荐的电影的ID, 第三推荐的电影的ID，...，最不推荐的电影的ID]。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 严禁输出任何注释、标签或额外文本。&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="label-guidance-v3-1">label-guidance-v3</h3>
<blockquote>
<p>相比于v2更规范</p>
</blockquote>
<p>Overall average NDCG@10 across all epochs = 0.62916</p>
<p>Overall average NDCG@10 across all epochs = 0.58186</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>system_message <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;system&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;你是一位具备电影专家知识的大语言模型助手，负责完成个性化电影推荐排序任务。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;任务目标：预测用户最有可能接下来观看的电影，并将所有候选电影按推荐强度从高到低排序。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;请严格依据以下步骤完成任务：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;1. 用户的观影历史按时间排序，越靠后越近期，兴趣相关性越强，请**重点分析最近3部电影**。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;2. 对每部候选电影，**基于真实情节可能性**生成以下标签：[类型]、[题材关键词]、[情绪基调]、[导演风格]。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;3. 分别比较每个候选电影与用户近期兴趣的**多维匹配度**（越匹配越靠前）。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;4. 注意：用户的下一部实际观看电影就在候选列表中，你应尽量将其排在推荐列表的前列，提升预测准确性。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;5. 输出格式要求：仅返回一个JSON数组，内容为候选电影的ID（按推荐顺序排列）。示例：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;[最推荐电影的ID, 第二推荐的电影的ID, 第三推荐的电影的ID，...，最不推荐的电影的ID]</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;⚠️ 严禁输出任何解释性文字、注释或标签，只能输出ID数组。&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    user_message <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;user&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;请分析以下用户的观影记录，推测其最有可能接下来观看的电影，并对候选电影列表按推荐强度排序。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【用户ID】：</span><span style="color:#e6db74">{</span>user_id<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【观影历史】（按时间顺序，越后越近期）：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>history_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【候选电影列表】（含用户下一部真实观看的电影）：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>candidate_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;任务要求：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 提取用户最近3部电影中的偏好特征（类型/题材/情绪/风格）。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 为每部候选电影生成标签并匹配上述偏好，按匹配度进行排序。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 输出格式必须为JSON数组，仅包含候选电影ID，如：[最推荐电影的ID, 第二推荐的电影的ID, 第三推荐的电影的ID，...，最不推荐的电影的ID]。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 禁止输出任何多余说明、格式说明、标签或注释。&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>Overall average NDCG@10 across all epochs = 0.55542</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>system_message <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;system&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;你是大语言模型中的电影推荐专家，任务是预测用户最可能接下来观看的电影，&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;并将候选电影按预测强度从高到低排序。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;请严格遵循以下步骤：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;1. 分析用户最近3部观影的[类型][题材][风格][情绪]，构建兴趣画像。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;2. 对候选电影逐一生成标签，与兴趣画像比对，按匹配度排序。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;3. 注意：**用户的真实目标电影就在候选列表中，你的排序应尽量将其排在首位**。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   - 本任务不是泛排序，而是行为预测。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;4. 输出格式：JSON数组，仅包含ID，顺序表示你对“下部观看预测”的排序。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   - 示例：[最可能的ID, ..., 最不可能的ID]</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   - 严禁输出解释性或多余文本。&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    user_message <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;user&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;请分析以下用户的观影记录，推测其最有可能接下来观看的电影，并对候选电影列表按推荐强度排序。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【用户ID】：</span><span style="color:#e6db74">{</span>user_id<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【观影历史】（按时间顺序，越后越近期）：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>history_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【候选电影列表】（含用户下一部真实观看的电影）：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>candidate_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;任务要求：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 提取用户最近3部电影中的偏好特征（类型/题材/情绪/风格）。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 为每部候选电影生成标签并匹配上述偏好，按匹配度进行排序。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 输出格式必须为JSON数组，仅包含候选电影ID，如：[最推荐电影的ID, 第二推荐的电影的ID, 第三推荐的电影的ID，...，最不推荐的电影的ID]。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 禁止输出任何多余说明、格式说明、标签或注释。&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>Epoch 2 average NDCG@10 = 0.48804</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>system_message <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;system&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;你是一位电影推荐专家模型，任务是基于用户的观影历史，对候选电影列表进行排序，&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;预测用户下一步的观看偏好，并输出一个推荐强度从高到低的电影ID列表。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;【执行步骤】：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;1. 从用户最近3部电影中提取其当前偏好特征（类型、题材、情绪、导演风格）。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;2. 为每个候选电影生成标签：[类型][题材][情绪][风格]。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;3. 比较每个候选电影与用户兴趣画像的匹配程度，并结合如下规则评估推荐强度：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   - 高强度：类型+题材均匹配。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   - 中强度：类型或题材匹配，且情绪或风格相似。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   - 弱强度：至少1维度接近用户偏好，其他不冲突。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   - 最弱：与用户历史完全无交集者，排在最后。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;提示：候选列表中包含用户真实观看的下一部电影，可能不完全匹配主流偏好，&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;请综合匹配维度与合理性，确保排序中涵盖目标并排序合理。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;【输出格式】：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 输出一个JSON数组，长度等于候选电影数量，按推荐强度从高到低排序。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 示例：[最推荐电影的ID, 第二推荐的电影ID, ..., 最不推荐的电影ID]</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 禁止输出解释、注释、标签或格式说明。&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    user_message <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;user&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;请根据以下用户的观影记录，预测其当前偏好，并对候选电影列表排序：</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【用户ID】：</span><span style="color:#e6db74">{</span>user_id<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【观影历史】（越后越近期）：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>history_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【候选电影列表】：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>candidate_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;任务说明：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 提取最近3部电影的偏好特征（类型/题材/情绪/风格）。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 为候选电影生成标签并比对。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 按照多强度匹配策略排序，输出完整推荐列表。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;输出格式：JSON数组，长度等于候选数量，如：[2492, 684, 738, ...]。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;请只输出数组，禁止输出任何解释性内容。&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>Overall average NDCG@10 across all epochs = 0.64271</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>system_message <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;system&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;你是一位电影推荐专家模型，任务是根据用户观影历史，预测用户最可能接下来观看的电影，&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;并对候选电影列表进行排序，输出推荐强度从高到低的电影ID数组。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;【工作流程】</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;1. 提取用户最近3部电影的偏好特征（类型、题材、情绪、导演风格）。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;2. 为每部候选电影生成内容标签：[类型][题材][情绪][风格]。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;3. 逐一比对每个候选电影与用户偏好的匹配程度：匹配维度越多，排序越前。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;4. 排序目标是预测用户接下来会观看哪部电影，不仅是兴趣相似，而是行为预测。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;5. 候选列表中包含用户的实际观看目标电影，请尽量将其排在前列，避免遗漏。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;6. 若目标电影与历史兴趣略有偏差，应予以保留并安排中前部，不应排在末位。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;【输出格式】</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 输出一个JSON数组，仅包含候选电影的ID，按推荐强度从高到低排序。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 长度必须等于候选电影数量。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 示例：[2492, 684, 738, ...]</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 禁止输出任何解释、注释或格式说明。&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    user_message <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;user&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;请根据以下用户的观影记录，预测其当前偏好，并对候选电影进行排序：</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【用户ID】：</span><span style="color:#e6db74">{</span>user_id<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【观影历史】（按时间排序，越后越近期）：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>history_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【候选电影列表】：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>candidate_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;任务要求：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 提取最近3部电影中的偏好特征（类型/题材/情绪/风格）。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 为每部候选电影生成内容标签并比对。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 排序目标是预测用户的下一部观看行为，而不仅仅是相似兴趣。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 候选中包含用户真实观看的目标电影，请尽量将其排在前列，但也要考虑整体匹配逻辑。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 输出格式为JSON数组，长度与候选电影数量一致，仅包含ID，如：[2492, 684, 738, ...]。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 禁止输出任何解释、标签或注释内容。&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><table>
  <thead>
      <tr>
          <th>NDCG@10</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0.68928</td>
      </tr>
      <tr>
          <td>0.68358</td>
      </tr>
      <tr>
          <td>0.68235</td>
      </tr>
      <tr>
          <td>0.69235</td>
      </tr>
  </tbody>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>system_message <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;system&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;你是一位电影推荐专家模型，任务是根据用户最近的观影行为预测其下一部最可能观看的电影，&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;并对给定的候选电影列表进行精准排序，输出推荐强度从高到低的电影ID数组，以最大化排序评估指标NDCG@10。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;【排序目标】</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 推荐重点在于预测真实用户行为，而非泛兴趣匹配；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 候选列表中**包含真实目标电影**，应最大程度地将其排序前置，确保NDCG@10达到或超过0.8。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;【推荐逻辑流程】</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;1. 提取用户最近3部观影记录中的偏好特征（类型、题材、情绪氛围、导演风格），形成兴趣画像；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;2. 对每部候选电影构建对应的四维内容标签，需基于真实内容描述，不可仅依标题推测；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;3. 计算候选电影与用户兴趣的匹配程度，生成推荐强度；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;4. 综合排序逻辑如下：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   - 【强匹配】：类型+题材完全一致，风格/情绪贴合 → 排前2位；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   - 【中匹配】：类型或题材匹配，且有风格或情绪相似点 → 排第3-5位；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   - 【容错匹配】：风格或情绪较接近，但题材创新或偏离主流兴趣 → 排第6-8位；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   - 【弱匹配】：标签脱节，风格差异大，与近期行为不符 → 排末位；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;   - 若候选项虽匹配度不强但有潜在行为目标特征（如冷门探索、片单延续等），允许其容错前移排序。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;【强化要求】</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 对真实目标电影（若能识别）应排序在前3位；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 对内容标签缺失或类型模糊的电影，需根据剧情、氛围、设定合理推理填补；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 不得基于标题或流行度主观推测，应以结构化分析为准。</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;【输出格式】</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 输出格式必须为JSON数组；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 数组内容仅含候选电影ID，顺序表示推荐强度，由高到低；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 禁止任何解释、注释或标签信息；</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;- 示例输出：[522, 706, 554, 738, 659, 729, 751, 405, 549, 475]&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    user_message <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;user&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;content&#34;</span>: (
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;请根据以下用户的观影记录，预测其当前偏好，并对候选电影进行排序：</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【用户ID】：</span><span style="color:#e6db74">{</span>user_id<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【观影历史】（按时间排序，越后越近期）：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>history_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;【候选电影列表】：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>candidate_str<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;任务要求：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 提取最近3部电影中的偏好特征（类型/题材/情绪/风格）。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 为每部候选电影生成内容标签并比对。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 排序目标是预测用户的下一部观看行为，而不仅仅是相似兴趣。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 候选中包含用户真实观看的目标电影，请尽量将其排在前列，但也要考虑整体匹配逻辑。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 输出格式为JSON数组，长度与候选电影数量一致，仅包含ID，如：[2492, 684, 738, ...]。</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;- 禁止输出任何解释、标签或注释内容。&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><ul class="pa0">
  
   <li class="list di">
     <a href="/tags/%E8%80%83%E8%AF%95/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">考试</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/post/%E5%A4%8D%E8%AF%95%E9%A1%B9%E7%9B%AE/">「复试」项目</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/%E5%A4%8D%E8%AF%95%E8%8B%B1%E8%AF%AD%E5%8F%A3%E8%AF%AD/">「复试」英语口语</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  HomePage 2025 
  </a>
    <div><div class="ananke-socials"><a href="https://www.facebook.com/patrick.kollitsch" target="_blank" rel="noopener"
        class="ananke-social-link link-transition facebook link dib z-999 pt3 pt0-l mr1"
        title="follow on Facebook - Opens in a new window"
        aria-label="follow on Facebook - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256C0 376 82.7 476.8 194.2 504.5V334.2H141.4V256h52.8V222.3c0-87.1 39.4-127.5 125-127.5c16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1c-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287V510.1C413.8 494.8 512 386.9 512 256h0z"/></svg>
            
          </span></a><a href="https://bsky.app/profile/kollitsch.dev" target="_blank" rel="noopener"
        class="ananke-social-link link-transition bluesky link dib z-999 pt3 pt0-l mr1"
        title="follow on Bluesky - Opens in a new window"
        aria-label="follow on Bluesky - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M407.8 294.7c-3.3-.4-6.7-.8-10-1.3c3.4 .4 6.7 .9 10 1.3zM288 227.1C261.9 176.4 190.9 81.9 124.9 35.3C61.6-9.4 37.5-1.7 21.6 5.5C3.3 13.8 0 41.9 0 58.4S9.1 194 15 213.9c19.5 65.7 89.1 87.9 153.2 80.7c3.3-.5 6.6-.9 10-1.4c-3.3 .5-6.6 1-10 1.4C74.3 308.6-9.1 342.8 100.3 464.5C220.6 589.1 265.1 437.8 288 361.1c22.9 76.7 49.2 222.5 185.6 103.4c102.4-103.4 28.1-156-65.8-169.9c-3.3-.4-6.7-.8-10-1.3c3.4 .4 6.7 .9 10 1.3c64.1 7.1 133.6-15.1 153.2-80.7C566.9 194 576 75 576 58.4s-3.3-44.7-21.6-52.9c-15.8-7.1-40-14.9-103.2 29.8C385.1 81.9 314.1 176.4 288 227.1z"/></svg>
            
          </span></a><a href="http://linkedin.com/in/patrickkollitsch" target="_blank" rel="noopener"
        class="ananke-social-link link-transition linkedin link dib z-999 pt3 pt0-l mr1"
        title="follow on LinkedIn - Opens in a new window"
        aria-label="follow on LinkedIn - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
            
          </span></a></div>
</div>
  </div>
</footer>

  </body>
</html>
